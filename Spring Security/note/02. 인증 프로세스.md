## 폼 인증 - formLogin()

폼 인증은 HTTP 기반의 폼 로그인 인증 메커니즘을 활성화하는 API 이다.
단순하게 활성화만 하는 것으로도 기본 로그인 페이지를 제공하며, 커스텀하게 만드는 방법도 제공한다.
웹 폼을 통해 자격증명, 즉 사용자 이름과 비밀번호를 서버 측에 전달하면 서버 측에서 인증 여부를 결정한다.

```java

@Configuration
@EnableWebSecurity
public class SecurityConfig {

    @Bean
    SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {
        http
                .formLogin(form -> form
                        .loginPage("/login") // 커스텀 로그인 페이지 경로
                        .defaultSuccessUrl("/home", true) // 로그인 성공 시 이동할 URL
                        .loginProcessingUrl("/login") // 로그인 프로세스 url
                        .successHandler((request, response, authentication) ->
                                log.info("Authentication Success")
                        )
                        .failureUrl("/login?error")
                        .failureHandler((request, response, exception) ->
                                log.error("Authentication Failure", exception)
                        )
                        .permitAll() // 로그인 페이지는 누구나 접근 가능
                );

        return http.build();
    }
}
```

### 폼 로그인 커스텀 페이지

```html
<!DOCTYPE html>
<html>
<head>
    <title>Login</title>
</head>
<body>
<form action="/login" method="post">
    <label for="username">Username:</label>
    <input type="text" id="username" name="username"><br>
    <label for="password">Password:</label>
    <input type="password" id="password" name="password"><br>
    <button type="submit">Login</button>
</form>
</body>
</html>
```

form 태그의 action url 은 loginProcessingUrl 메서드에서 설정한 값과 일치해야 한다.

## 폼 인증 필터 - UsernamePasswordAuthenticationFilter

스프링 시큐리티에서 폼 로그인을 설정하면, 사용자가 로그인 폼에 입력한 아이디와 비밀번호가 `UsernamePasswordAuthenticationFilter`를 통해 추출되어
`AuthenticationManager`로
인증이 위임되고, 인증에 성공하면 `UsernamePasswordAuthenticationToken` 객체가 생성되어 `SecurityContext`에 저장되게 되어 있다. 이후 필터 체인에서
`AuthorizationFilter`가 `SecurityContext`의 인증 객체를 확인하여 사용자의 리소스 접근 권한을 검사하게 되어 있으며, 인증 성공 시 세션 관련 처리는
`SessionAuthenticationStrategy`에 따라 결정되게 되어 있다. 이러한 인증과 인가 과정은 폼 로그인 설정 시 자동으로 등록되는 기본 로그인 및 로그아웃 페이지와 함께 작동하며, 각 인증 필터는
자신만의 인증 토큰 타입을 반환할 수 있다.

스프링 시큐리티의 각 필터, 특히 폼 인증 필터는 `RequestMatcher`를 가지고 있어, 필터 리스트를 순회하는 동안 각 필터가 특정 HTTP 요청에만 동작하도록 할 수 있다.
예를 들어, `UsernamePasswordAuthenticationFilter`는 기본적으로 /login 경로로 들어오는 POST 요청만 처리하며, 이는 formLogin API를 통해 변경이 가능하다.

인증 성공 및 실패 시 각각 `AuthenticationSuccessHandler`와 `AuthenticationFailureHandler`가 호출되어, 인증 결과에 따라 다른 동작을 수행할 수 있다. 또한, 폼
로그인 시
`CSRF` 보호가 기본적으로 활성화되어 있으므로, 로그인 폼에 CSRF 토큰이 포함되어야 한다. 필요에 따라 `Remember-Me` 기능이나 커스텀 인증 필터를 추가로 적용할 수 있으며, 인증 객체인
UsernamePasswordAuthenticationToken은 인증 전/후에 상태가 달라지며, 인증 후에는 `principal`, `credentials`, `authorities` 정보가 채워진다.

## 기본 인증 - httpBasic()

HTTP Basic 인증은 RFC 7235 표준에 따라 정의되어 있으며, 대부분의 브라우저는 HTTP Basic 인증 기능을 내장하고 있다.

인증이 필요한 서버의 리소스에 인증 정보 없이 접근하려고 하면, 서버는 401 상태 코드를 응답으로 반환한다. 이때 응답 헤더의 `WWW-Authenticate` 필드에 보안 영역과 인증 방식을 명시하여, 해당 리소스에
접근하기 위해 어떤 인증 방법을 사용해야 하는지 클라이언트에게 알려준다.

클라이언트가 서버의 리소스에 접근할 때는 `Authorization` 헤더에 사용자 이름과 비밀번호를 콜론(:)으로 연결한 뒤, 이를 Base64로 인코딩한 값을 담아 전송한다.

Base64는 암호화 방식이 아니라 단순한 데이터 인코딩 기술이므로, 안전한 통신을 위해서는 반드시 HTTPS나 TLS와 같은 보안 프로토콜과 함께 사용해야 한다.

```java
@Configuration
@EnableWebSecurity
public class SecurityConfig {

    @Bean
    SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {
        http.httpBasic(basic -> basic
                .realmName("security") // 인증 영역 이름 설정
                .authenticationEntryPoint((request, response, authException) -> {
                    response.setStatus(HttpServletResponse.SC_UNAUTHORIZED); // 401 상태 코드 설정
                    response.setContentType("application/json");
                    response.getWriter().write("{\"error\": \"Unauthorized\"}"); // JSON 응답 반환
                })
        );
        return http.build(); // SecurityFilterChain 객체 반환
    }
}
```
- HTTP Basic 기능 활성화를 위해 `HttpBasicConfigurer`를 이용하는 `Customizer`가 사용되고 있다. 
- realmName API 는 여러 개의 리소스 그룹이 있을 때, 구역마다 이름을 다르게 하여 관리할 수 있다. 예로, /admin과 /user 처럼 서로 다른 리소스에 대해 이름으로 구별할 수 있다. 
- `AuthenticationEntryPoint` 설정은 인증에 필요한 리소스에 인증 정보 없이 접근하는 등의 예외가 발생했을 때 어떻게 응답할지를 결정하는 역할을 한다.
