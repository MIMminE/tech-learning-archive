## OAuth 2.0 Grant Type 개요

클라이언트가 사용자를 대신하여 사용자의 승인하에 인가서버로부터 권한을 부여받는 것을 의미한다.
승인 -> 로그인, 권한 부여 -> 동의

권한 부여하는 방식에 여러가지가 있으며,

`Authorization Code Grant Type`
권한 코드 부여 타입, 서버 사이드 어플리케이션에서 자주 사용되며, 가장 보안이 좋은 방식이다.
다른 방식에 비해 두개의 단계로 나누어져 있음

`Implicit Grant Type [Deprecated]`
암시적 부여 타입, 공개 클라이언트 어플리케이션에서 사용되는 방식이다. SPA 기반 자바스크립트 앱, 모바일 앱 등에서 사용된다.
보안에 취약하다. Access Token 이 브라우저에 노출되기 때문에 보안에 취약하다.

`Resource Owner Password Credentials Grant Type [Deprecated]`
리소스 사용자의 아이디와 비밀번호를 통해 직접 자격증명을 얻는 방식이다.

사용자가 클라이언트에게 자신이 속한 인가 서버의 계정과 비밀번호를 전달하는 것이다.
아이디 패스워드 자체가 네트워크를 통하게 되고, 서버에게 계정이 노출되므로 보안이 취약하다.

`Client Credentials Grant Type`
클라이언트 아이디와 클라이언트 Secret 만 가지고 자격증명을 부여하는 타입, 사용자라는 개념이 없다.
클라이언트 자체가 사용자 역할을 하는 것이며, UI나 화면이 없는 데몬 등에서 사용된다. (서버 TO 서버 환경에서 사용된다)

`Refresh Token Grant Type`
Access Token 를 발급받는 방식(Authorization Code Type, Resource Owner Password Type)에서 함께 전달되는 Refresh Token 를 사용할 때
사용한다. 권한부여 승인 과정을 다시 거치지 않고 토큰을 재발급하기 위한 방식이다.

`PKCE-enhanced Authorization Code Grant Type`
키가 함께 사용되는 Authorization Code Type 방식, 강화된 방식이다.

### 권한 부여 흐름 선택 기준

Front Channel

Back Channel

- 클라이언트가 최종 사용자를 가지지 않는다면 Client Credentials Flow 선택
- 클라이언트가 최종 사용자가 있으며, 클라이언트에 대한 고도의 신뢰성이 있다면 Resource Owner Flow 선택
- 클라이언트가 최종 사용자가 있으며, 다른 권한 부여 타입에 대한 지원도 해야 한다면 Authorization Code Flow 선택

### 매개 변수 용어

- client_id : 인가서버에 등록된 클라이언트에 대해 생성된 고유 아이디
- client_secret : 인가서버에 등록된 특정 클라이언트의 client_id 에 대해 생성된 비밀 값
- response_type : 애플리케이션이 권한 부여 코드 흐름을 시작하고 있음을 인증 서버에 알린다. code, token, id_token 이 있다.
- grant_type : 권한 부여 타입을 지정할 때 사용된다. (authorization_code, password, client_credentials, refresh_token)
- redirect_uri : 사용자가 응용 프로그램을 성공적으로 리다이렉트할 uri를 지정한다. 여기서 지정된 uri는 인증 코드를 생성할 때 사용된 redirect_uri 와 일치해야 한다.
- scope : 어플리케이션이 사용자 데이터에 접근하는 것을 제한하기 위해 사용된다. email, profile, read, write 등. 사용자에 의해 제한된 권한 인가권을 발행함으로써 데이터 접근을 제한한다.
- state : CSRF 공격 방지를 위해 사용된다. 임의의 문자열을 생성하고 요청에 포함하고 사용자가 앱을 승인한 후 서버로부터 동일한 값이 반환되는지 확인한다.

## Authorization Code Grant Type - 권한 부여 코드 승인 방식
1. 사용자가 클라이언트에 대한 요청을 승인하면, 클라이언트가 설정해둔 Redirect URI 로 인가서버가 임시 코드를 담아 리다이렉트를 수행한다.
2. 클라이언트는 해당 임시 코드를 받아 자신의 client_id, client_password 등의 정보와 함께 다시 인가서버에게 전달한다. 이때는 클라이언트는 브라우저와 같은 공개 클라이언트가 아닌, 백 서버에서 전달하게 되고 이를 받은 인가서버는 액세스 토큰을 반환해준다.
3. 액세스 토큰 발급을 위해 임시 코드와 함께 전달된 클라이언트의 요청에서 인가서버에 정식으로 등록된 클라이언트임을 id와 패스워드를 통해 자격증명을 진행할 수 있으므로 인증 코드 누출이 되더라도 안전하게 사용할 수 있다.
4. 또한, 백 서버에서 액세서 토큰 발급을 하는 것이므로 브라우저 등에 노출되지 않게되어 임시 코드조차 알아내기 쉽지 않다.


## Implicit Grant Type - 암묵적 승인 방식

## Resource Owner Password Credentials Grant Type - 패스워드 자격증명 승인 방식